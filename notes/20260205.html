---
layout: default
title: "いいねボタンを実装｜ブログ風｜こんどうかずきの部屋"
description: "リクエストにお応えして。"
og_title: "いいねボタンを実装"
og_description: "リクエストに応えて、いいねボタンを。"
header_lead: ""
---

<p class="sub breadcrumb">
  <a href="{{ '/' | relative_url }}">Home</a> /
  <a href="{{ '/notes/' | relative_url }}">ブログ風</a> /
  いいねボタン
</p>

<header class="post-header">
  <h1 class="post-h1">いいねボタン</h1>
  <p class="sub post-meta">
    公開日：2026-02-05
    <span class="sep">/</span>
    最終更新：2026-02-05
    <span class="sep">/</span>
    タグ：
    <a href="{{ '/notes/?tag=log' | relative_url }}">log</a>
  </p>
</header>

<section class="card">

  <p>
  ここ数日は実験だったり卒論・修論指導で忙しくしております。私自身も様々な報告書の作成に追われて、これぞ年度末といった感じです。
  </p>
　
  <p>
  さてと、本日はリクエストを受けて、いいねボタンの実装に取り組んでみました。
<br>できてますかね？よければ押してみてください。
<br>…できてないなぁ……。
  </p>

</section>

<div class="like" data-like-id="2026-02-05-post1">
  <button type="button" class="like-btn">👍 Like <span class="like-count">-</span></button>
  <span class="like-msg"></span>
</div>

<section class="card card-tight" id="post-nav">
  <h2 class="h2-tight">記事ナビ</h2>
  <ul class="simple">
    <li id="prev-item">← 前の記事：<span class="sub">（読み込み中）</span></li>
    <li id="next-item">次の記事 →：<span class="sub">（読み込み中）</span></li>
    <li>一覧に戻る：<a href="{{ '/notes/' | relative_url }}">ブログ風トップ</a></li>
  </ul>
</section>

<script src="{{ '/notes/post-nav.js' | relative_url }}"></script>

<script>
(() => {
  const NAMESPACE = "konkaz-homepage"; // 固有。変えてOK（英数と-推奨）

  async function apiGetOrZero(key) {
    const url = `https://api.countapi.xyz/get/${NAMESPACE}/${encodeURIComponent(key)}`;
    const res = await fetch(url);
    if (!res.ok) return 0; // 未作成などは0扱い
    const data = await res.json();
    return Number.isFinite(data.value) ? data.value : 0;
  }

  async function apiHit(key) {
    const url = `https://api.countapi.xyz/hit/${NAMESPACE}/${encodeURIComponent(key)}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error("hit failed");
    const data = await res.json();
    return Number.isFinite(data.value) ? data.value : 0;
  }

  // DOMが確実に揃ってから動かす（レイアウトやscript位置変更にも強い）
  window.addEventListener("DOMContentLoaded", async () => {
    const boxes = document.querySelectorAll(".like[data-like-id]");
    for (const box of boxes) {
      const id = box.getAttribute("data-like-id");
      if (!id) continue;

      const key = `like:${id}`;
      const storageKey = `liked:${id}`;

      const btn = box.querySelector(".like-btn");
      const countEl = box.querySelector(".like-count");
      const msgEl = box.querySelector(".like-msg");

      if (!btn || !countEl || !msgEl) continue;

      // 初期表示（未作成でも0）
      countEl.textContent = await apiGetOrZero(key);

      // 既に押してたら無効化
      if (localStorage.getItem(storageKey) === "1") {
        btn.disabled = true;
        btn.style.opacity = "0.6";
        msgEl.textContent = "Thanks!";
        continue;
      }

      btn.addEventListener("click", async () => {
        btn.disabled = true;
        btn.style.opacity = "0.6";
        try {
          const newCount = await apiHit(key);
          countEl.textContent = newCount;
          localStorage.setItem(storageKey, "1");
          msgEl.textContent = "Thanks!";
        } catch {
          btn.disabled = false;
          btn.style.opacity = "1";
          msgEl.textContent = "Failed";
        }
      });
    }
  });
})();
</script>